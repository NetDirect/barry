<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Barry: record.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_edc0f428e3eefcfdce9c25befd901c57.html">src</a></div>
<h1>record.cc</h1><a href="record_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">///</span>
<a name="l00002"></a>00002 <span class="comment"></span><span class="comment">/// \file       record.cc</span>
<a name="l00003"></a>00003 <span class="comment"></span><span class="comment">///             Blackberry database record classes.  Help translate data</span>
<a name="l00004"></a>00004 <span class="comment"></span><span class="comment">///             from data packets to useful structurs, and back.</span>
<a name="l00005"></a>00005 <span class="comment"></span><span class="comment">///             This header provides the common types and classes</span>
<a name="l00006"></a>00006 <span class="comment"></span><span class="comment">///             used by the general record parser classes in the</span>
<a name="l00007"></a>00007 <span class="comment"></span><span class="comment">///             r_*.h files.  Only application-safe API stuff goes in</span>
<a name="l00008"></a>00008 <span class="comment"></span><span class="comment">///             here.  Internal library types go in record-internal.h</span>
<a name="l00009"></a>00009 <span class="comment"></span><span class="comment">///</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">/*</span>
<a name="l00012"></a>00012 <span class="comment">    Copyright (C) 2005-2008, Net Direct Inc. (http://www.netdirect.ca/)</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
<a name="l00015"></a>00015 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00016"></a>00016 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00017"></a>00017 <span class="comment">    (at your option) any later version.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
<a name="l00020"></a>00020 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00021"></a>00021 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">    See the GNU General Public License in the COPYING file at the</span>
<a name="l00024"></a>00024 <span class="comment">    root directory of this project for more details.</span>
<a name="l00025"></a>00025 <span class="comment">*/</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="record_8h.html">record.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="record-internal_8h.html">record-internal.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="protocol_8h.html">protocol.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="protostructs_8h.html">protostructs.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="data_8h.html">data.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="time_8h.html">time.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="error_8h.html">error.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "<a class="code" href="endian_8h.html">endian.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="time_8h.html">time.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="record_8cc.html#cbad865d9d402cdd00b0d2316f29f93c">00041</a> <span class="preprocessor">#define __DEBUG_MODE__</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#include "debug.h"</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">using namespace </span>std;
<a name="l00045"></a>00045 <span class="keyword">using namespace </span>Barry::Protocol;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">namespace </span>Barry {
<a name="l00048"></a>00048 <span class="comment"></span>
<a name="l00049"></a>00049 <span class="comment">//////////////////////////////////////////////////////////////////////////////</span>
<a name="l00050"></a>00050 <span class="comment"></span><span class="comment">// Field builder helper functions</span>
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="namespaceBarry.html#2ff26eea9acda6c17e7859c06a3082c2">00052</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#2ff26eea9acda6c17e7859c06a3082c2">BuildField1900</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, uint8_t type, time_t t)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054         size_t timesize = <a class="code" href="protostructs_8h.html#040776e3088ea85bec7fbe2925fef241">COMMON_FIELD_MIN1900_SIZE</a>;
<a name="l00055"></a>00055         size_t fieldsize = <a class="code" href="protostructs_8h.html#57f20ae1d9eb7d03be551c4431f9b464">COMMON_FIELD_HEADER_SIZE</a> + timesize;
<a name="l00056"></a>00056         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pd = data.<a class="code" href="classBarry_1_1Data.html#e90208900e5d30ea3415e49e555f34fb">GetBuffer</a>(size + fieldsize) + size;
<a name="l00057"></a>00057         <a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *field = (<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *) pd;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#d925ea6184991b94acc1cacd7d818ca9">size</a> = <a class="code" href="endian_8h.html#3df42dec5c871ba33930cfa7e092228f">htobs</a>(timesize);
<a name="l00060"></a>00060         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#a14660dd93df6c653e879c62d6f2babc">type</a> = type;
<a name="l00061"></a>00061         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#30ce680a7247791a82b9ec78f550a3e3">u</a>.<a class="code" href="unionBarry_1_1Protocol_1_1CommonField_1_1CommonFieldData.html#a3763df7edf89e66ef95e52c4bd77ac3">min1900</a> = <a class="code" href="namespaceBarry.html#9a5f34af395d282e5e5645e152f3548c">time2min</a>(t);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         size += fieldsize;
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">00066</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, uint8_t type, <span class="keywordtype">char</span> c)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068         size_t strsize = 1;
<a name="l00069"></a>00069         size_t fieldsize = <a class="code" href="protostructs_8h.html#57f20ae1d9eb7d03be551c4431f9b464">COMMON_FIELD_HEADER_SIZE</a> + strsize;
<a name="l00070"></a>00070         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pd = data.<a class="code" href="classBarry_1_1Data.html#e90208900e5d30ea3415e49e555f34fb">GetBuffer</a>(size + fieldsize) + size;
<a name="l00071"></a>00071         <a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *field = (<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *) pd;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#d925ea6184991b94acc1cacd7d818ca9">size</a> = <a class="code" href="endian_8h.html#3df42dec5c871ba33930cfa7e092228f">htobs</a>(strsize);
<a name="l00074"></a>00074         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#a14660dd93df6c653e879c62d6f2babc">type</a> = type;
<a name="l00075"></a>00075         memcpy(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#30ce680a7247791a82b9ec78f550a3e3">u</a>.<a class="code" href="unionBarry_1_1Protocol_1_1CommonField_1_1CommonFieldData.html#ba84010fcd8c1dac4f4f96bfb1004994">raw</a>, &amp;c, strsize);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         size += fieldsize;
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="namespaceBarry.html#a4628e5e88fbba52c297be7dea04d350">00080</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, uint8_t type, uint16_t value)
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082         size_t strsize = 2;
<a name="l00083"></a>00083         size_t fieldsize = <a class="code" href="protostructs_8h.html#57f20ae1d9eb7d03be551c4431f9b464">COMMON_FIELD_HEADER_SIZE</a> + strsize;
<a name="l00084"></a>00084         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pd = data.<a class="code" href="classBarry_1_1Data.html#e90208900e5d30ea3415e49e555f34fb">GetBuffer</a>(size + fieldsize) + size;
<a name="l00085"></a>00085         <a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *field = (<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *) pd;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#d925ea6184991b94acc1cacd7d818ca9">size</a> = <a class="code" href="endian_8h.html#3df42dec5c871ba33930cfa7e092228f">htobs</a>(strsize);
<a name="l00088"></a>00088         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#a14660dd93df6c653e879c62d6f2babc">type</a> = type;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         uint16_t store = <a class="code" href="endian_8h.html#3df42dec5c871ba33930cfa7e092228f">htobs</a>(value);
<a name="l00091"></a>00091         memcpy(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#30ce680a7247791a82b9ec78f550a3e3">u</a>.<a class="code" href="unionBarry_1_1Protocol_1_1CommonField_1_1CommonFieldData.html#ba84010fcd8c1dac4f4f96bfb1004994">raw</a>, &amp;store, strsize);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         size += fieldsize;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="namespaceBarry.html#a2a00aa9bc6d02c7066ec861493b39b2">00096</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, uint8_t type, <span class="keyword">const</span> std::string &amp;str)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098         <span class="comment">// include null terminator</span>
<a name="l00099"></a>00099         <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(data, size, type, str.c_str(), str.size() + 1);
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="namespaceBarry.html#d198dbd747cc7a1e0a18b7cf8a1554a6">00102</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, uint8_t type,
<a name="l00103"></a>00103                 <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t bufsize)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105         <span class="comment">// include null terminator</span>
<a name="l00106"></a>00106         size_t fieldsize = <a class="code" href="protostructs_8h.html#57f20ae1d9eb7d03be551c4431f9b464">COMMON_FIELD_HEADER_SIZE</a> + bufsize;
<a name="l00107"></a>00107         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pd = data.<a class="code" href="classBarry_1_1Data.html#e90208900e5d30ea3415e49e555f34fb">GetBuffer</a>(size + fieldsize) + size;
<a name="l00108"></a>00108         <a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *field = (<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *) pd;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#d925ea6184991b94acc1cacd7d818ca9">size</a> = <a class="code" href="endian_8h.html#3df42dec5c871ba33930cfa7e092228f">htobs</a>(bufsize);
<a name="l00111"></a>00111         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#a14660dd93df6c653e879c62d6f2babc">type</a> = type;
<a name="l00112"></a>00112         memcpy(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#30ce680a7247791a82b9ec78f550a3e3">u</a>.<a class="code" href="unionBarry_1_1Protocol_1_1CommonField_1_1CommonFieldData.html#ba84010fcd8c1dac4f4f96bfb1004994">raw</a>, buf, bufsize);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         size += fieldsize;
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="namespaceBarry.html#f1241f31031c05d3637190e2d698d722">00117</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, <span class="keyword">const</span> <a class="code" href="structBarry_1_1UnknownField.html">Barry::UnknownField</a> &amp;field)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119         <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(data, size, field.<a class="code" href="structBarry_1_1UnknownField.html#ab76a15d7922542ea6d252f42a3a291f">type</a>,
<a name="l00120"></a>00120                 field.<a class="code" href="structBarry_1_1UnknownField.html#6b97a7513b61bfe5de3e9b32dd07a102">data</a>.<a class="code" href="structBarry_1_1UnknownData.html#84a08a8614a9c54fccb51c25c46f50c1">raw_data</a>.data(), field.<a class="code" href="structBarry_1_1UnknownField.html#6b97a7513b61bfe5de3e9b32dd07a102">data</a>.<a class="code" href="structBarry_1_1UnknownData.html#84a08a8614a9c54fccb51c25c46f50c1">raw_data</a>.size());
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="namespaceBarry.html#ffc63387880713c559c75b6cd7574ec1">00123</a> <span class="keywordtype">void</span> <a class="code" href="namespaceBarry.html#7ab51028217044060ff322ab6ebe50b2">BuildField</a>(<a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t &amp;size, uint8_t type, <span class="keyword">const</span> <a class="code" href="structBarry_1_1Protocol_1_1GroupLink.html">Barry::Protocol::GroupLink</a> &amp;link)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125         size_t linksize = <span class="keyword">sizeof</span>(<a class="code" href="structBarry_1_1Protocol_1_1GroupLink.html">Barry::Protocol::GroupLink</a>);
<a name="l00126"></a>00126         size_t fieldsize = <a class="code" href="protostructs_8h.html#57f20ae1d9eb7d03be551c4431f9b464">COMMON_FIELD_HEADER_SIZE</a> + linksize;
<a name="l00127"></a>00127         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pd = data.<a class="code" href="classBarry_1_1Data.html#e90208900e5d30ea3415e49e555f34fb">GetBuffer</a>(size + fieldsize) + size;
<a name="l00128"></a>00128         <a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *field = (<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">CommonField</a> *) pd;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#d925ea6184991b94acc1cacd7d818ca9">size</a> = <a class="code" href="endian_8h.html#3df42dec5c871ba33930cfa7e092228f">htobs</a>(linksize);
<a name="l00131"></a>00131         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#a14660dd93df6c653e879c62d6f2babc">type</a> = type;
<a name="l00132"></a>00132         field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#30ce680a7247791a82b9ec78f550a3e3">u</a>.<a class="code" href="unionBarry_1_1Protocol_1_1CommonField_1_1CommonFieldData.html#a97818407cf00c6cadcc1d6be65749c5">link</a> = link;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         size += fieldsize;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="namespaceBarry.html#7e79741158450f2cb977996f57a7164a">00137</a> std::string <a class="code" href="namespaceBarry.html#7e79741158450f2cb977996f57a7164a">ParseFieldString</a>(<span class="keyword">const</span> <a class="code" href="structBarry_1_1Protocol_1_1CommonField.html">Barry::Protocol::CommonField</a> *field)
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139         <span class="comment">// make no assumptions here, and pass the full size in as</span>
<a name="l00140"></a>00140         <span class="comment">// the maxlen, even though 99% of the time, it will be a null...</span>
<a name="l00141"></a>00141         <span class="comment">// this function can be used by non-null terminated strings as well</span>
<a name="l00142"></a>00142         <span class="keywordflow">return</span> <a class="code" href="namespaceBarry.html#7e79741158450f2cb977996f57a7164a">ParseFieldString</a>(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#30ce680a7247791a82b9ec78f550a3e3">u</a>.<a class="code" href="unionBarry_1_1Protocol_1_1CommonField_1_1CommonFieldData.html#ba84010fcd8c1dac4f4f96bfb1004994">raw</a>, <a class="code" href="endian_8h.html#54e24cc5abdbe4ec539017d31fb845df">btohs</a>(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommonField.html#d925ea6184991b94acc1cacd7d818ca9">size</a>));
<a name="l00143"></a>00143 }
<a name="l00144"></a>00144 
<a name="l00145"></a><a class="code" href="namespaceBarry.html#649a723a898ca48dee0cac7cf9620bc6">00145</a> std::string <a class="code" href="namespaceBarry.html#7e79741158450f2cb977996f57a7164a">ParseFieldString</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *data, uint16_t maxlen)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147         <span class="keyword">const</span> <span class="keywordtype">char</span> *str = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)data;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="comment">// find last non-null character, since some fields</span>
<a name="l00150"></a>00150         <span class="comment">// can have multiple null terminators</span>
<a name="l00151"></a>00151         <span class="keywordflow">while</span>( maxlen &amp;&amp; str[maxlen-1] == 0 )
<a name="l00152"></a>00152                 maxlen--;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="keywordflow">return</span> std::string(str, maxlen);
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="comment"></span>
<a name="l00158"></a>00158 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
<a name="l00159"></a>00159 <span class="comment"></span><span class="comment">// CommandTable class</span>
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="classBarry_1_1CommandTable.html#db96047a1ad0e59a6aa522a6ba75c576">00161</a> <a class="code" href="classBarry_1_1CommandTable.html#db96047a1ad0e59a6aa522a6ba75c576">CommandTable::CommandTable</a>()
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="classBarry_1_1CommandTable.html#3eed97a1502277d1ef56c9ea7cfc2534">00165</a> <a class="code" href="classBarry_1_1CommandTable.html#3eed97a1502277d1ef56c9ea7cfc2534">CommandTable::~CommandTable</a>()
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* CommandTable::ParseField(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *begin,
<a name="l00170"></a>00170                                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172         <span class="comment">// check if there is enough data for a header</span>
<a name="l00173"></a>00173         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *headend = begin + <span class="keyword">sizeof</span>(<a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html">CommandTableField</a>);
<a name="l00174"></a>00174         <span class="keywordflow">if</span>( headend &gt; end )
<a name="l00175"></a>00175                 <span class="keywordflow">return</span> headend;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="keyword">const</span> <a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html">CommandTableField</a> *field = (<span class="keyword">const</span> <a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html">CommandTableField</a> *) begin;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="comment">// advance and check size</span>
<a name="l00180"></a>00180         begin += <a class="code" href="protostructs_8h.html#224ebbcc67f17a29e73314cbbd04f1ab">COMMAND_FIELD_HEADER_SIZE</a> + field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html#3ad3c5b79636dd3effe1ef9cb8827b91">size</a>;       <span class="comment">// size is byte</span>
<a name="l00181"></a>00181         <span class="keywordflow">if</span>( begin &gt; end )               <span class="comment">// if begin==end, we are ok</span>
<a name="l00182"></a>00182                 <span class="keywordflow">return</span> begin;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="keywordflow">if</span>( !field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html#3ad3c5b79636dd3effe1ef9cb8827b91">size</a> )              <span class="comment">// if field has no size, something's up</span>
<a name="l00185"></a>00185                 <span class="keywordflow">return</span> begin;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <a class="code" href="classBarry_1_1CommandTable.html#3fc9f0a08bb74201e5e0c41e4294565f">Command</a> command;
<a name="l00188"></a>00188         command.<a class="code" href="structBarry_1_1CommandTableCommand.html#5faac0bd414e6e6d6eb9ac547b4678b6">Code</a> = field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html#4ff0f7c57aaed7c8ce12d553f358858c">code</a>;
<a name="l00189"></a>00189         command.Name.assign((<span class="keyword">const</span> <span class="keywordtype">char</span> *)field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html#6d861479e2670364993c91872672fedb">name</a>, field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1CommandTableField.html#3ad3c5b79636dd3effe1ef9cb8827b91">size</a>);
<a name="l00190"></a>00190         <a class="code" href="classBarry_1_1CommandTable.html#17e62b90d9763a2ce87c902c2a1776f3">Commands</a>.push_back(command);
<a name="l00191"></a>00191         <span class="keywordflow">return</span> begin;
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="classBarry_1_1CommandTable.html#822cf8e08b9cb6520cfcf808c5da45c8">00194</a> <span class="keywordtype">void</span> <a class="code" href="classBarry_1_1CommandTable.html#822cf8e08b9cb6520cfcf808c5da45c8">CommandTable::Parse</a>(<span class="keyword">const</span> <a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data, size_t offset)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196         <span class="keywordflow">if</span>( offset &gt;= data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>() )
<a name="l00197"></a>00197                 <span class="keywordflow">return</span>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *begin = data.<a class="code" href="classBarry_1_1Data.html#1150ece40dec4e044c85179929b0c5c3">GetData</a>() + offset;
<a name="l00200"></a>00200         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end = data.<a class="code" href="classBarry_1_1Data.html#1150ece40dec4e044c85179929b0c5c3">GetData</a>() + data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>();
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">while</span>( begin &lt; end )
<a name="l00203"></a>00203                 begin = ParseField(begin, end);
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="classBarry_1_1CommandTable.html#7ccc22b520e90854be88d0ee1ba51537">00206</a> <span class="keywordtype">void</span> <a class="code" href="classBarry_1_1CommandTable.html#7ccc22b520e90854be88d0ee1ba51537">CommandTable::Clear</a>()
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208         <a class="code" href="classBarry_1_1CommandTable.html#17e62b90d9763a2ce87c902c2a1776f3">Commands</a>.clear();
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="classBarry_1_1CommandTable.html#e9f6f64577edd2732a6a3b55204c7838">00211</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classBarry_1_1CommandTable.html#e9f6f64577edd2732a6a3b55204c7838">CommandTable::GetCommand</a>(<span class="keyword">const</span> std::string &amp;name)<span class="keyword"> const</span>
<a name="l00212"></a>00212 <span class="keyword"></span>{
<a name="l00213"></a>00213         CommandArrayType::const_iterator b = <a class="code" href="classBarry_1_1CommandTable.html#17e62b90d9763a2ce87c902c2a1776f3">Commands</a>.begin();
<a name="l00214"></a>00214         <span class="keywordflow">for</span>( ; b != <a class="code" href="classBarry_1_1CommandTable.html#17e62b90d9763a2ce87c902c2a1776f3">Commands</a>.end(); b++ )
<a name="l00215"></a>00215                 <span class="keywordflow">if</span>( b-&gt;Name == name )
<a name="l00216"></a>00216                         <span class="keywordflow">return</span> b-&gt;Code;
<a name="l00217"></a>00217         <span class="keywordflow">return</span> 0;
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="classBarry_1_1CommandTable.html#737f689195693e71f342662329e3d864">00220</a> <span class="keywordtype">void</span> <a class="code" href="bs11nread_8cc.html#811d7b2bd118e6bcadfd61214b9d0fe7">CommandTable::Dump</a>(std::ostream &amp;os)<span class="keyword"> const</span>
<a name="l00221"></a>00221 <span class="keyword"></span>{
<a name="l00222"></a>00222         CommandArrayType::const_iterator b = <a class="code" href="classBarry_1_1CommandTable.html#17e62b90d9763a2ce87c902c2a1776f3">Commands</a>.begin();
<a name="l00223"></a>00223         os &lt;&lt; <span class="stringliteral">"Command table:\n"</span>;
<a name="l00224"></a>00224         <span class="keywordflow">for</span>( ; b != <a class="code" href="classBarry_1_1CommandTable.html#17e62b90d9763a2ce87c902c2a1776f3">Commands</a>.end(); b++ ) {
<a name="l00225"></a>00225                 os &lt;&lt; <span class="stringliteral">"    Command: 0x"</span> &lt;&lt; setbase(16) &lt;&lt; b-&gt;Code
<a name="l00226"></a>00226                    &lt;&lt; <span class="stringliteral">" '"</span> &lt;&lt; b-&gt;Name &lt;&lt; <span class="stringliteral">"'\n"</span>;
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment"></span>
<a name="l00232"></a>00232 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
<a name="l00233"></a>00233 <span class="comment"></span><span class="comment">// RecordStateTable class</span>
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="classBarry_1_1RecordStateTable.html#42fbdac04e0006a223198d13b4b65625">00235</a> <a class="code" href="classBarry_1_1RecordStateTable.html#42fbdac04e0006a223198d13b4b65625">RecordStateTable::RecordStateTable</a>()
<a name="l00236"></a>00236         : m_LastNewRecordId(1)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="classBarry_1_1RecordStateTable.html#cfa997a10bcb02ada19e1254c766bdb9">00240</a> <a class="code" href="classBarry_1_1RecordStateTable.html#cfa997a10bcb02ada19e1254c766bdb9">RecordStateTable::~RecordStateTable</a>()
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* RecordStateTable::ParseField(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *begin,
<a name="l00245"></a>00245                                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end)
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247         <span class="keyword">const</span> <a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html">RecordStateTableField</a> *field = (<span class="keyword">const</span> <a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html">RecordStateTableField</a> *) begin;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249         <span class="comment">// advance and check size</span>
<a name="l00250"></a>00250         begin += <span class="keyword">sizeof</span>(<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html">RecordStateTableField</a>);
<a name="l00251"></a>00251         <span class="keywordflow">if</span>( begin &gt; end )               <span class="comment">// if begin==end, we are ok</span>
<a name="l00252"></a>00252                 <span class="keywordflow">return</span> begin;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <a class="code" href="classBarry_1_1RecordStateTable.html#9d84d5cd648ad649430e6d6d208a1d04">State</a> state;
<a name="l00255"></a>00255         state.<a class="code" href="structBarry_1_1RecordStateTableState.html#0a23d98a2892833519763e64c840d704">Index</a> = <a class="code" href="endian_8h.html#54e24cc5abdbe4ec539017d31fb845df">btohs</a>(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html#40abe0a5985ca6b9de526cf56556121c">index</a>);
<a name="l00256"></a>00256         state.RecordId = <a class="code" href="endian_8h.html#e62f53519212f6480265a5a746e9abc3">btohl</a>(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html#f9ecdf1a8245745329fdb35e4386d233">uniqueId</a>);
<a name="l00257"></a>00257         state.Dirty = (field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html#a9038ad017b82dfebd9b3957db14e904">flags</a> &amp; <a class="code" href="protostructs_8h.html#212a992845062fb4d644718b248fc374">BARRY_RSTF_DIRTY</a>) != 0;
<a name="l00258"></a>00258         state.RecType = field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html#383881071b660ab29eee58df5b7b33be">rectype</a>;
<a name="l00259"></a>00259         state.Unknown2.assign((<span class="keyword">const</span> <span class="keywordtype">char</span>*)field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html#5bd23bf5fd93ac6707ab4f3331cb02b6">unknown2</a>, <span class="keyword">sizeof</span>(field-&gt;<a class="code" href="structBarry_1_1Protocol_1_1RecordStateTableField.html#5bd23bf5fd93ac6707ab4f3331cb02b6">unknown2</a>));
<a name="l00260"></a>00260         <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>[state.Index] = state;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         <span class="keywordflow">return</span> begin;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classBarry_1_1RecordStateTable.html#2f33a44d9ca9ff412ee3f0e4399d9240">00265</a> <span class="keywordtype">void</span> <a class="code" href="classBarry_1_1RecordStateTable.html#2f33a44d9ca9ff412ee3f0e4399d9240">RecordStateTable::Parse</a>(<span class="keyword">const</span> <a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267         size_t offset = 12;     <span class="comment">// skipping the unknown 2 bytes at start</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="keywordflow">if</span>( offset &gt;= data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>() )
<a name="l00270"></a>00270                 <span class="keywordflow">return</span>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *begin = data.<a class="code" href="classBarry_1_1Data.html#1150ece40dec4e044c85179929b0c5c3">GetData</a>() + offset;
<a name="l00273"></a>00273         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end = data.<a class="code" href="classBarry_1_1Data.html#1150ece40dec4e044c85179929b0c5c3">GetData</a>() + data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>();
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="keywordflow">while</span>( begin &lt; end )
<a name="l00276"></a>00276                 begin = ParseField(begin, end);
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a><a class="code" href="classBarry_1_1RecordStateTable.html#63f0c7adb88af5b9da1d69c77632f16d">00279</a> <span class="keywordtype">void</span> <a class="code" href="classBarry_1_1RecordStateTable.html#63f0c7adb88af5b9da1d69c77632f16d">RecordStateTable::Clear</a>()
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281         <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.clear();
<a name="l00282"></a>00282         m_LastNewRecordId = 1;
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="comment">// Searches the StateMap table for RecordId, and returns the "index"</span>
<a name="l00286"></a>00286 <span class="comment">// in the map if found.  Returns true if found, false if not.</span>
<a name="l00287"></a>00287 <span class="comment">// pFoundIndex can be null if only the existence of the index is desired</span>
<a name="l00288"></a><a class="code" href="classBarry_1_1RecordStateTable.html#98b865f1ad8eeb201e3781083f1d60ac">00288</a> <span class="keywordtype">bool</span> <a class="code" href="classBarry_1_1RecordStateTable.html#98b865f1ad8eeb201e3781083f1d60ac">RecordStateTable::GetIndex</a>(uint32_t RecordId, IndexType *pFoundIndex)<span class="keyword"> const</span>
<a name="l00289"></a>00289 <span class="keyword"></span>{
<a name="l00290"></a>00290         StateMapType::const_iterator i = <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.begin();
<a name="l00291"></a>00291         <span class="keywordflow">for</span>( ; i != <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.end(); ++i ) {
<a name="l00292"></a>00292                 <span class="keywordflow">if</span>( i-&gt;second.RecordId == RecordId ) {
<a name="l00293"></a>00293                         <span class="keywordflow">if</span>( pFoundIndex )
<a name="l00294"></a>00294                                 *pFoundIndex = i-&gt;first;
<a name="l00295"></a>00295                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00296"></a>00296                 }
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="comment">// Generate a new RecordId that is not in the state table.</span>
<a name="l00302"></a>00302 <span class="comment">// Starts at 1 and keeps incrementing until a free one is found.</span>
<a name="l00303"></a><a class="code" href="classBarry_1_1RecordStateTable.html#7c1923764c73d191f7a17eab5f4b81bd">00303</a> uint32_t <a class="code" href="classBarry_1_1RecordStateTable.html#7c1923764c73d191f7a17eab5f4b81bd">RecordStateTable::MakeNewRecordId</a>()<span class="keyword"> const</span>
<a name="l00304"></a>00304 <span class="keyword"></span>{
<a name="l00305"></a>00305         <span class="comment">// start with next Id</span>
<a name="l00306"></a>00306         m_LastNewRecordId++;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="comment">// make sure it doesn't already exist</span>
<a name="l00309"></a>00309         StateMapType::const_iterator i = <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.begin();
<a name="l00310"></a>00310         <span class="keywordflow">while</span>( i != <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.end() ) {
<a name="l00311"></a>00311                 <span class="keywordflow">if</span>( m_LastNewRecordId == i-&gt;second.RecordId ) {
<a name="l00312"></a>00312                         m_LastNewRecordId++;            <span class="comment">// try again</span>
<a name="l00313"></a>00313                         i = <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.begin();           <span class="comment">// start over</span>
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315                 <span class="keywordflow">else</span> {
<a name="l00316"></a>00316                         ++i;                            <span class="comment">// next State</span>
<a name="l00317"></a>00317                 }
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319         <span class="keywordflow">return</span> m_LastNewRecordId;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="classBarry_1_1RecordStateTable.html#b017813d4a7f1b6f7a1e80b44d17f551">00322</a> <span class="keywordtype">void</span> <a class="code" href="bs11nread_8cc.html#811d7b2bd118e6bcadfd61214b9d0fe7">RecordStateTable::Dump</a>(std::ostream &amp;os)<span class="keyword"> const</span>
<a name="l00323"></a>00323 <span class="keyword"></span>{
<a name="l00324"></a>00324         ios::fmtflags oldflags = os.setf(ios::right);
<a name="l00325"></a>00325         <span class="keywordtype">char</span> fill = os.fill(<span class="charliteral">' '</span>);
<a name="l00326"></a>00326         <span class="keywordtype">bool</span> bPrintAscii = <a class="code" href="classBarry_1_1Data.html#5f39baa25327580b460653ddda156df2">Data::PrintAscii</a>();
<a name="l00327"></a>00327         <a class="code" href="classBarry_1_1Data.html#5f39baa25327580b460653ddda156df2">Data::PrintAscii</a>(<span class="keyword">false</span>);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         os &lt;&lt; <span class="stringliteral">"  Index  RecordId    Dirty  RecType"</span> &lt;&lt; endl;
<a name="l00330"></a>00330         os &lt;&lt; <span class="stringliteral">"-------  ----------  -----  -------"</span> &lt;&lt; endl;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         StateMapType::const_iterator b, e = <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.end();
<a name="l00333"></a>00333         <span class="keywordflow">for</span>( b = <a class="code" href="classBarry_1_1RecordStateTable.html#07dda609cdff321db956f31aa4b55e27">StateMap</a>.begin(); b != e ; ++b ) {
<a name="l00334"></a>00334                 <span class="keyword">const</span> <a class="code" href="structBarry_1_1RecordStateTableState.html">State</a> &amp;state = b-&gt;second;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336                 os.fill(<span class="charliteral">' '</span>);
<a name="l00337"></a>00337                 os &lt;&lt; setbase(10) &lt;&lt; setw(7) &lt;&lt; state.Index;
<a name="l00338"></a>00338                 os &lt;&lt; <span class="stringliteral">"  0x"</span> &lt;&lt; setbase(16) &lt;&lt; setfill(<span class="charliteral">'0'</span>) &lt;&lt; setw(8) &lt;&lt; state.RecordId;
<a name="l00339"></a>00339                 os &lt;&lt; <span class="stringliteral">"  "</span> &lt;&lt; setfill(<span class="charliteral">' '</span>) &lt;&lt; setw(5) &lt;&lt; (state.Dirty ? <span class="stringliteral">"yes"</span> : <span class="stringliteral">"no"</span>);
<a name="l00340"></a>00340                 os &lt;&lt; <span class="stringliteral">"     0x"</span> &lt;&lt; setbase(16) &lt;&lt; setfill(<span class="charliteral">'0'</span>) &lt;&lt; setw(2) &lt;&lt; state.RecType;
<a name="l00341"></a>00341                 os &lt;&lt; <span class="stringliteral">"   "</span> &lt;&lt; <a class="code" href="classBarry_1_1Data.html">Data</a>(state.Unknown2.data(), state.Unknown2.size());
<a name="l00342"></a>00342         }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <span class="comment">// cleanup the stream</span>
<a name="l00345"></a>00345         os.flags(oldflags);
<a name="l00346"></a>00346         os.fill(fill);
<a name="l00347"></a>00347         <a class="code" href="classBarry_1_1Data.html#5f39baa25327580b460653ddda156df2">Data::PrintAscii</a>(bPrintAscii);
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment"></span>
<a name="l00352"></a>00352 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
<a name="l00353"></a>00353 <span class="comment"></span><span class="comment">// DatabaseDatabase class</span>
<a name="l00354"></a>00354 
<a name="l00355"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#350fb98cf46474e400bd3a8beaee0136">00355</a> <a class="code" href="classBarry_1_1DatabaseDatabase.html#350fb98cf46474e400bd3a8beaee0136">DatabaseDatabase::DatabaseDatabase</a>()
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
<a name="l00359"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#6e9aa1d87088811db66d397c1fdd96e1">00359</a> <a class="code" href="classBarry_1_1DatabaseDatabase.html#6e9aa1d87088811db66d397c1fdd96e1">DatabaseDatabase::~DatabaseDatabase</a>()
<a name="l00360"></a>00360 {
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="keyword">template</span> &lt;<span class="keyword">class</span> RecordType, <span class="keyword">class</span> FieldType&gt;
<a name="l00364"></a>00364 <span class="keywordtype">void</span> DatabaseDatabase::ParseRec(<span class="keyword">const</span> RecordType &amp;rec, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end)
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="keyword">template</span> &lt;<span class="keyword">class</span> FieldType&gt;
<a name="l00369"></a>00369 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* DatabaseDatabase::ParseField(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *begin,
<a name="l00370"></a>00370                                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end)
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372         <span class="comment">// check if there is enough data for a header</span>
<a name="l00373"></a>00373         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *headend = begin + <span class="keyword">sizeof</span>(FieldType);
<a name="l00374"></a>00374         <span class="keywordflow">if</span>( headend &gt; end )
<a name="l00375"></a>00375                 <span class="keywordflow">return</span> headend;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377         <span class="comment">// get our header</span>
<a name="l00378"></a>00378         <span class="keyword">const</span> FieldType *field = (<span class="keyword">const</span> FieldType *) begin;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="comment">// advance and check size</span>
<a name="l00381"></a>00381         begin += <span class="keyword">sizeof</span>(FieldType) - <span class="keyword">sizeof</span>(field-&gt;name) + <a class="code" href="namespaceBarry.html#0c471b5a8bfafb216e1b6e44e571d61a">ConvertHtoB</a>(field-&gt;nameSize);
<a name="l00382"></a>00382         <span class="keywordflow">if</span>( begin &gt; end )               <span class="comment">// if begin==end, we are ok</span>
<a name="l00383"></a>00383                 <span class="keywordflow">return</span> begin;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         <span class="keywordflow">if</span>( !<a class="code" href="namespaceBarry.html#0c471b5a8bfafb216e1b6e44e571d61a">ConvertHtoB</a>(field-&gt;nameSize) ) <span class="comment">// if field has no size, something's up</span>
<a name="l00386"></a>00386                 <span class="keywordflow">return</span> begin;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <a class="code" href="classBarry_1_1DatabaseDatabase.html#b08f09058ac26bd6a51169568771ae1b">Database</a> db;
<a name="l00389"></a>00389         db.Number = <a class="code" href="namespaceBarry.html#0c471b5a8bfafb216e1b6e44e571d61a">ConvertHtoB</a>(field-&gt;dbNumber);
<a name="l00390"></a>00390         db.RecordCount = <a class="code" href="namespaceBarry.html#0c471b5a8bfafb216e1b6e44e571d61a">ConvertHtoB</a>(field-&gt;dbRecordCount);
<a name="l00391"></a>00391         db.Name.assign((<span class="keyword">const</span> <span class="keywordtype">char</span> *)field-&gt;name, <a class="code" href="namespaceBarry.html#0c471b5a8bfafb216e1b6e44e571d61a">ConvertHtoB</a>(field-&gt;nameSize) - 1);
<a name="l00392"></a>00392         <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.push_back(db);
<a name="l00393"></a>00393         <span class="keywordflow">return</span> begin;
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#5f1c828240c2d5a0ed93089d472ef6fa">00396</a> <span class="keywordtype">void</span> <a class="code" href="classBarry_1_1DatabaseDatabase.html#5f1c828240c2d5a0ed93089d472ef6fa">DatabaseDatabase::Parse</a>(<span class="keyword">const</span> <a class="code" href="classBarry_1_1Data.html">Data</a> &amp;data)
<a name="l00397"></a>00397 {
<a name="l00398"></a>00398         <span class="comment">// check size to make sure we have up to the DBAccess operation byte</span>
<a name="l00399"></a>00399         <span class="keywordflow">if</span>( data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>() &lt; (<a class="code" href="protostructs_8h.html#055e12292da129a22300c5735f0b6bd8">SB_PACKET_DBACCESS_HEADER_SIZE</a> + 1) )
<a name="l00400"></a>00400                 <span class="keywordflow">return</span>;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         <a class="code" href="protostructs_8h.html#76636d846ce0539d6027117e8a566f66">MAKE_PACKET</a>(pack, data);
<a name="l00403"></a>00403         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *begin = 0;
<a name="l00404"></a>00404         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end = data.<a class="code" href="classBarry_1_1Data.html#1150ece40dec4e044c85179929b0c5c3">GetData</a>() + data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>();
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <span class="keywordflow">switch</span>( pack-&gt;u.db.u.response.operation )
<a name="l00407"></a>00407         {
<a name="l00408"></a>00408         <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#0c6bc01f6afecb869a03cc69021feaaa">SB_DBOP_GET_DBDB</a>:
<a name="l00409"></a>00409                 <span class="comment">// using the new protocol</span>
<a name="l00410"></a>00410                 <span class="keywordflow">if</span>( data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>() &gt; <a class="code" href="protostructs_8h.html#b99aea0834b9e7f0625ddf69f1c07a67">SB_PACKET_DBDB_HEADER_SIZE</a> ) {
<a name="l00411"></a>00411                         begin = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)
<a name="l00412"></a>00412                                 &amp;pack-&gt;u.db.u.response.u.dbdb.field[0];
<a name="l00413"></a>00413 
<a name="l00414"></a>00414                         <span class="comment">// this while check is ok, since ParseField checks</span>
<a name="l00415"></a>00415                         <span class="comment">// for header size</span>
<a name="l00416"></a>00416                         <span class="keywordflow">while</span>( begin &lt; end )
<a name="l00417"></a>00417                                 begin = ParseField&lt;DBDBField&gt;(begin, end);
<a name="l00418"></a>00418                 }
<a name="l00419"></a>00419                 <span class="keywordflow">else</span>
<a name="l00420"></a>00420                         dout(<span class="stringliteral">"DatabaseDatabase: not enough data for parsing"</span>);
<a name="l00421"></a>00421                 <span class="keywordflow">break</span>;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423         <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#8471f0dfa8bd254fb0fc5b674030fb20">SB_DBOP_OLD_GET_DBDB</a>:
<a name="l00424"></a>00424                 <span class="comment">// using the old protocol</span>
<a name="l00425"></a>00425                 <span class="keywordflow">if</span>( data.<a class="code" href="classBarry_1_1Data.html#c7efe576f0bff2726c46f22b01ccd2e1">GetSize</a>() &gt; <a class="code" href="protostructs_8h.html#3c8396268ac8f6ecfb7967303ccf2dd7">SB_PACKET_OLD_DBDB_HEADER_SIZE</a> ) {
<a name="l00426"></a>00426                         begin = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)
<a name="l00427"></a>00427                                 &amp;pack-&gt;u.db.u.response.u.old_dbdb.field[0];
<a name="l00428"></a>00428 
<a name="l00429"></a>00429                         <span class="comment">// this while check is ok, since ParseField checks</span>
<a name="l00430"></a>00430                         <span class="comment">// for header size</span>
<a name="l00431"></a>00431                         <span class="keywordflow">while</span>( begin &lt; end )
<a name="l00432"></a>00432                                 begin = ParseField&lt;OldDBDBField&gt;(begin, end);
<a name="l00433"></a>00433                 }
<a name="l00434"></a>00434                 <span class="keywordflow">else</span>
<a name="l00435"></a>00435                         dout(<span class="stringliteral">"DatabaseDatabase: not enough data for parsing"</span>);
<a name="l00436"></a>00436                 <span class="keywordflow">break</span>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="keywordflow">default</span>:
<a name="l00439"></a>00439                 <span class="comment">// unknown protocol</span>
<a name="l00440"></a>00440                 dout(<span class="stringliteral">"Unknown protocol"</span>);
<a name="l00441"></a>00441                 <span class="keywordflow">break</span>;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#38263aec11b64128477ccc7fa1d2fddd">00447</a> <span class="keywordtype">void</span> <a class="code" href="classBarry_1_1DatabaseDatabase.html#38263aec11b64128477ccc7fa1d2fddd">DatabaseDatabase::Clear</a>()
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449         <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.clear();
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#4c925c0858a604279d18df3076055fcf">00452</a> <span class="keywordtype">bool</span> <a class="code" href="classBarry_1_1DatabaseDatabase.html#4c925c0858a604279d18df3076055fcf">DatabaseDatabase::GetDBNumber</a>(<span class="keyword">const</span> std::string &amp;name,
<a name="l00453"></a>00453                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;number)<span class="keyword"> const</span>
<a name="l00454"></a>00454 <span class="keyword"></span>{
<a name="l00455"></a>00455         DatabaseArrayType::const_iterator b = <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.begin();
<a name="l00456"></a>00456         <span class="keywordflow">for</span>( ; b != <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.end(); b++ )
<a name="l00457"></a>00457                 <span class="keywordflow">if</span>( b-&gt;Name == name ) {
<a name="l00458"></a>00458                         number = b-&gt;Number;
<a name="l00459"></a>00459                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00460"></a>00460                 }
<a name="l00461"></a>00461         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#f0f8f87b6b9cdb66c84199f0c0f42b3c">00464</a> <span class="keywordtype">bool</span> <a class="code" href="classBarry_1_1DatabaseDatabase.html#f0f8f87b6b9cdb66c84199f0c0f42b3c">DatabaseDatabase::GetDBName</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> number,
<a name="l00465"></a>00465                                  std::string &amp;name)<span class="keyword"> const</span>
<a name="l00466"></a>00466 <span class="keyword"></span>{
<a name="l00467"></a>00467         DatabaseArrayType::const_iterator b = <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.begin();
<a name="l00468"></a>00468         <span class="keywordflow">for</span>( ; b != <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.end(); b++ )
<a name="l00469"></a>00469                 <span class="keywordflow">if</span>( b-&gt;Number == number ) {
<a name="l00470"></a>00470                         name = b-&gt;Name;
<a name="l00471"></a>00471                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00472"></a>00472                 }
<a name="l00473"></a>00473         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="classBarry_1_1DatabaseDatabase.html#48add8b85b5c879e093d89edcd00a7e5">00476</a> <span class="keywordtype">void</span> <a class="code" href="bs11nread_8cc.html#811d7b2bd118e6bcadfd61214b9d0fe7">DatabaseDatabase::Dump</a>(std::ostream &amp;os)<span class="keyword"> const</span>
<a name="l00477"></a>00477 <span class="keyword"></span>{
<a name="l00478"></a>00478         DatabaseArrayType::const_iterator b = <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.begin();
<a name="l00479"></a>00479         os &lt;&lt; <span class="stringliteral">"Database database:\n"</span>;
<a name="l00480"></a>00480         <span class="keywordflow">for</span>( ; b != <a class="code" href="classBarry_1_1DatabaseDatabase.html#58aafd32fc7ccbddb9839a0727d679b9">Databases</a>.end(); b++ ) {
<a name="l00481"></a>00481                 os &lt;&lt; <span class="stringliteral">"    Database: 0x"</span> &lt;&lt; setbase(16) &lt;&lt; b-&gt;Number
<a name="l00482"></a>00482                    &lt;&lt; <span class="stringliteral">" '"</span> &lt;&lt; b-&gt;Name &lt;&lt; <span class="stringliteral">"' (records: "</span>
<a name="l00483"></a>00483                    &lt;&lt; setbase(10) &lt;&lt; b-&gt;RecordCount &lt;&lt; <span class="stringliteral">")\n"</span>;
<a name="l00484"></a>00484         }
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00488"></a><a class="code" href="namespaceBarry.html#4c7d4678043069fd71a0975b045fa549">00488</a> std::ostream&amp; operator&lt;&lt; (std::ostream &amp;os, const std::vector&lt;UnknownField&gt; &amp;unknowns)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490         std::vector&lt;UnknownField&gt;::const_iterator
<a name="l00491"></a>00491                 ub = unknowns.begin(), ue = unknowns.end();
<a name="l00492"></a>00492         <span class="keywordflow">if</span>( ub != ue )
<a name="l00493"></a>00493                 os &lt;&lt; <span class="stringliteral">"    Unknowns:\n"</span>;
<a name="l00494"></a>00494         <span class="keywordflow">for</span>( ; ub != ue; ub++ ) {
<a name="l00495"></a>00495                 os &lt;&lt; <span class="stringliteral">"        Type: 0x"</span> &lt;&lt; setbase(16)
<a name="l00496"></a>00496                    &lt;&lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) ub-&gt;type
<a name="l00497"></a>00497                    &lt;&lt; <span class="stringliteral">" Data:\n"</span> &lt;&lt; <a class="code" href="classBarry_1_1Data.html">Data</a>(ub-&gt;data.data(), ub-&gt;data.size());
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499         <span class="keywordflow">return</span> os;
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 <span class="comment"></span>
<a name="l00504"></a>00504 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
<a name="l00505"></a>00505 <span class="comment"></span><span class="comment">// EmailAddress class</span>
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="namespaceBarry.html#6a97ff2e1642a77ee69e46d7067befb7">00507</a> std::ostream&amp; <a class="code" href="namespaceBarry.html#6e6ca3f4de1f16eed89c26548bee2e82">operator&lt;&lt;</a>(std::ostream &amp;os, <span class="keyword">const</span> <a class="code" href="structBarry_1_1EmailAddress.html">EmailAddress</a> &amp;msga) {
<a name="l00508"></a>00508         os &lt;&lt; msga.<a class="code" href="structBarry_1_1EmailAddress.html#3f08fd2a2235637488b3cd3e5065d9f2">Name</a>.c_str() &lt;&lt; <span class="stringliteral">" &lt;"</span> &lt;&lt; msga.<a class="code" href="structBarry_1_1EmailAddress.html#08db75817db614f5e3048051645aee4a">Email</a>.c_str() &lt;&lt; <span class="stringliteral">"&gt;"</span>;
<a name="l00509"></a>00509         <span class="keywordflow">return</span> os;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="comment"></span>
<a name="l00513"></a>00513 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
<a name="l00514"></a>00514 <span class="comment"></span><span class="comment">// PostalAddress class</span>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="comment">//</span>
<a name="l00517"></a>00517 <span class="comment">// GetLabel</span>
<a name="l00518"></a>00518 <span class="comment">//</span><span class="comment"></span>
<a name="l00519"></a>00519 <span class="comment">/// Format a mailing address into a single string, handling missing fields.</span>
<a name="l00520"></a>00520 <span class="comment">///</span>
<a name="l00521"></a><a class="code" href="structBarry_1_1PostalAddress.html#a8349a1418a7b2d2194172b2a0dc6032">00521</a> <span class="comment"></span>std::string <a class="code" href="structBarry_1_1PostalAddress.html#a8349a1418a7b2d2194172b2a0dc6032">PostalAddress::GetLabel</a>()<span class="keyword"> const</span>
<a name="l00522"></a>00522 <span class="keyword"></span>{
<a name="l00523"></a>00523         std::string address = <a class="code" href="structBarry_1_1PostalAddress.html#2e5bf55020013116bee586dba504b3c6">Address1</a>;
<a name="l00524"></a>00524         <span class="keywordflow">if</span>( <a class="code" href="structBarry_1_1PostalAddress.html#a7f5873d5e77fb817da03917dac7ceea">Address2</a>.size() ) {
<a name="l00525"></a>00525                 <span class="keywordflow">if</span>( address.size() )
<a name="l00526"></a>00526                         address += <span class="stringliteral">"\n"</span>;
<a name="l00527"></a>00527                 address += <a class="code" href="structBarry_1_1PostalAddress.html#a7f5873d5e77fb817da03917dac7ceea">Address2</a>;
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529         <span class="keywordflow">if</span>( <a class="code" href="structBarry_1_1PostalAddress.html#252de66ffb0cf66f75986cb2ef86c416">Address3</a>.size() ) {
<a name="l00530"></a>00530                 <span class="keywordflow">if</span>( address.size() )
<a name="l00531"></a>00531                         address += <span class="stringliteral">"\n"</span>;
<a name="l00532"></a>00532                 address += <a class="code" href="structBarry_1_1PostalAddress.html#252de66ffb0cf66f75986cb2ef86c416">Address3</a>;
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534         <span class="keywordflow">if</span>( address.size() )
<a name="l00535"></a>00535                 address += <span class="stringliteral">"\n"</span>;
<a name="l00536"></a>00536         <span class="keywordflow">if</span>( <a class="code" href="structBarry_1_1PostalAddress.html#6511b31607fcda83c188b6520a2cb358">City</a>.size() )
<a name="l00537"></a>00537                 address += <a class="code" href="structBarry_1_1PostalAddress.html#6511b31607fcda83c188b6520a2cb358">City</a> + <span class="stringliteral">" "</span>;
<a name="l00538"></a>00538         <span class="keywordflow">if</span>( <a class="code" href="structBarry_1_1PostalAddress.html#f2587006506b0f3b6083055e8c745683">Province</a>.size() )
<a name="l00539"></a>00539                 address += <a class="code" href="structBarry_1_1PostalAddress.html#f2587006506b0f3b6083055e8c745683">Province</a> + <span class="stringliteral">" "</span>;
<a name="l00540"></a>00540         <span class="keywordflow">if</span>( <a class="code" href="structBarry_1_1PostalAddress.html#d08352875d36aa2a15e941bfc69cd38f">Country</a>.size() )
<a name="l00541"></a>00541                 address += <a class="code" href="structBarry_1_1PostalAddress.html#d08352875d36aa2a15e941bfc69cd38f">Country</a>;
<a name="l00542"></a>00542         <span class="keywordflow">if</span>( address.size() )
<a name="l00543"></a>00543                 address += <span class="stringliteral">"\n"</span>;
<a name="l00544"></a>00544         <span class="keywordflow">if</span>( <a class="code" href="structBarry_1_1PostalAddress.html#dd7f064dc5600d5cd0cd4b5348c377d9">PostalCode</a>.size() )
<a name="l00545"></a>00545                 address += <a class="code" href="structBarry_1_1PostalAddress.html#dd7f064dc5600d5cd0cd4b5348c377d9">PostalCode</a>;
<a name="l00546"></a>00546         
<a name="l00547"></a>00547         <span class="keywordflow">return</span> address;
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00550"></a><a class="code" href="structBarry_1_1PostalAddress.html#5d2e2ea2928848d06454b7adb7b31394">00550</a> <span class="keywordtype">void</span> <a class="code" href="structBarry_1_1PostalAddress.html#5d2e2ea2928848d06454b7adb7b31394">PostalAddress::Clear</a>()
<a name="l00551"></a>00551 {
<a name="l00552"></a>00552         <a class="code" href="structBarry_1_1PostalAddress.html#2e5bf55020013116bee586dba504b3c6">Address1</a>.clear();
<a name="l00553"></a>00553         <a class="code" href="structBarry_1_1PostalAddress.html#a7f5873d5e77fb817da03917dac7ceea">Address2</a>.clear();
<a name="l00554"></a>00554         <a class="code" href="structBarry_1_1PostalAddress.html#252de66ffb0cf66f75986cb2ef86c416">Address3</a>.clear();
<a name="l00555"></a>00555         <a class="code" href="structBarry_1_1PostalAddress.html#6511b31607fcda83c188b6520a2cb358">City</a>.clear();
<a name="l00556"></a>00556         <a class="code" href="structBarry_1_1PostalAddress.html#f2587006506b0f3b6083055e8c745683">Province</a>.clear();
<a name="l00557"></a>00557         <a class="code" href="structBarry_1_1PostalAddress.html#dd7f064dc5600d5cd0cd4b5348c377d9">PostalCode</a>.clear();
<a name="l00558"></a>00558         <a class="code" href="structBarry_1_1PostalAddress.html#d08352875d36aa2a15e941bfc69cd38f">Country</a>.clear();
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="namespaceBarry.html#9616b91c8c6b948b2d85db422687d3ff">00561</a> std::ostream&amp; <a class="code" href="namespaceBarry.html#6e6ca3f4de1f16eed89c26548bee2e82">operator&lt;&lt;</a>(std::ostream &amp;os, <span class="keyword">const</span> <a class="code" href="structBarry_1_1PostalAddress.html">PostalAddress</a> &amp;post) {
<a name="l00562"></a>00562         os &lt;&lt; post.<a class="code" href="structBarry_1_1PostalAddress.html#a8349a1418a7b2d2194172b2a0dc6032">GetLabel</a>();
<a name="l00563"></a>00563         <span class="keywordflow">return</span> os;
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="comment"></span>
<a name="l00568"></a>00568 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
<a name="l00569"></a>00569 <span class="comment"></span><span class="comment">// Date class</span>
<a name="l00570"></a>00570 
<a name="l00571"></a><a class="code" href="structBarry_1_1Date.html#6b556fcdf00878d2cbbf8b6cf929c1c5">00571</a> <a class="code" href="structBarry_1_1Date.html#0b1c24a3cae591d61a8e9e5a427efe03">Date::Date</a>(<span class="keyword">const</span> <span class="keyword">struct</span> tm *timep)
<a name="l00572"></a>00572 {
<a name="l00573"></a>00573         <a class="code" href="structBarry_1_1Date.html#3d41821a5c21ef255c64b6f540d877cc">FromTm</a>(timep);
<a name="l00574"></a>00574 }
<a name="l00575"></a>00575 
<a name="l00576"></a><a class="code" href="structBarry_1_1Date.html#a7ffeefbca1467e9984ceef1f074581d">00576</a> <span class="keywordtype">void</span> <a class="code" href="structBarry_1_1Date.html#a7ffeefbca1467e9984ceef1f074581d">Date::Clear</a>()
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578         <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> = <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a> = <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a> = 0;
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="structBarry_1_1Date.html#3696f1e8eace41212ea02cdddf0cb633">00581</a> <span class="keywordtype">void</span> <a class="code" href="structBarry_1_1Date.html#3696f1e8eace41212ea02cdddf0cb633">Date::ToTm</a>(<span class="keyword">struct</span> tm *timep)<span class="keyword"> const</span>
<a name="l00582"></a>00582 <span class="keyword"></span>{
<a name="l00583"></a>00583         memset(timep, 0, <span class="keyword">sizeof</span>(tm));
<a name="l00584"></a>00584         timep-&gt;tm_year = <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a> - 1900;
<a name="l00585"></a>00585         timep-&gt;tm_mon = <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a>;
<a name="l00586"></a>00586         timep-&gt;tm_mday = <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a>;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="structBarry_1_1Date.html#98bd05f92bb59e89f3359a9042fda4e0">00589</a> std::string <a class="code" href="structBarry_1_1Date.html#98bd05f92bb59e89f3359a9042fda4e0">Date::ToYYYYMMDD</a>()<span class="keyword"> const</span>
<a name="l00590"></a>00590 <span class="keyword"></span>{
<a name="l00591"></a>00591         std::ostringstream oss;
<a name="l00592"></a>00592         oss     &lt;&lt; setw(4) &lt;&lt; <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a>
<a name="l00593"></a>00593                 &lt;&lt; setw(2) &lt;&lt; <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> + 1
<a name="l00594"></a>00594                 &lt;&lt; setw(2) &lt;&lt; <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a>;
<a name="l00595"></a>00595         <span class="keywordflow">return</span> oss.str();
<a name="l00596"></a>00596 }
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 <span class="comment">//</span>
<a name="l00599"></a>00599 <span class="comment">// ToBBString</span>
<a name="l00600"></a>00600 <span class="comment">//</span><span class="comment"></span>
<a name="l00601"></a>00601 <span class="comment">/// The Blackberry stores Birthday and Anniversary date fields</span>
<a name="l00602"></a>00602 <span class="comment">/// with the format: DD/MM/YYYY</span>
<a name="l00603"></a>00603 <span class="comment">///</span>
<a name="l00604"></a><a class="code" href="structBarry_1_1Date.html#a523b28fa9f83fb188df52d7822eeaf6">00604</a> <span class="comment"></span>std::string <a class="code" href="structBarry_1_1Date.html#a523b28fa9f83fb188df52d7822eeaf6">Date::ToBBString</a>()<span class="keyword"> const</span>
<a name="l00605"></a>00605 <span class="keyword"></span>{
<a name="l00606"></a>00606         std::ostringstream oss;
<a name="l00607"></a>00607         oss     &lt;&lt; setw(2) &lt;&lt; <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a>
<a name="l00608"></a>00608                 &lt;&lt; <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> + 1
<a name="l00609"></a>00609                 &lt;&lt; <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a>;
<a name="l00610"></a>00610         <span class="keywordflow">return</span> oss.str();
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a><a class="code" href="structBarry_1_1Date.html#3d41821a5c21ef255c64b6f540d877cc">00613</a> <span class="keywordtype">bool</span> <a class="code" href="structBarry_1_1Date.html#3d41821a5c21ef255c64b6f540d877cc">Date::FromTm</a>(<span class="keyword">const</span> <span class="keyword">struct</span> tm *timep)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615         <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a> = timep-&gt;tm_year + 1900;
<a name="l00616"></a>00616         <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> = timep-&gt;tm_mon;
<a name="l00617"></a>00617         <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a> = timep-&gt;tm_mday;
<a name="l00618"></a>00618         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="structBarry_1_1Date.html#f85c6992f67f8237956319521841c371">00621</a> <span class="keywordtype">bool</span> <a class="code" href="structBarry_1_1Date.html#f85c6992f67f8237956319521841c371">Date::FromBBString</a>(<span class="keyword">const</span> std::string &amp;str)
<a name="l00622"></a>00622 {
<a name="l00623"></a>00623         <span class="keywordtype">int</span> m, d, y;
<a name="l00624"></a>00624         <span class="keywordflow">if</span>( 3 == sscanf(str.c_str(), <span class="stringliteral">"%d/%d/%d"</span>, &amp;d, &amp;m, &amp;y) ) {
<a name="l00625"></a>00625                 <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a> = y;
<a name="l00626"></a>00626                 <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> = m - 1;
<a name="l00627"></a>00627                 <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a> = d;
<a name="l00628"></a>00628                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a><a class="code" href="structBarry_1_1Date.html#64f2033e973e2f8706de92decf75ab1f">00633</a> <span class="keywordtype">bool</span> <a class="code" href="structBarry_1_1Date.html#64f2033e973e2f8706de92decf75ab1f">Date::FromYYYYMMDD</a>(<span class="keyword">const</span> std::string &amp;str)
<a name="l00634"></a>00634 {
<a name="l00635"></a>00635         <span class="keywordtype">int</span> m, d, y;
<a name="l00636"></a>00636         <span class="keywordflow">if</span>( 3 == sscanf(str.c_str(), <span class="stringliteral">"%4d%2d%2d"</span>, &amp;y, &amp;m, &amp;d) ) {
<a name="l00637"></a>00637                 <a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a> = y;
<a name="l00638"></a>00638                 <a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> = m - 1;
<a name="l00639"></a>00639                 <a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a> = d;
<a name="l00640"></a>00640                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="namespaceBarry.html#3254b8f00a773547f606db38e3832292">00645</a> std::ostream&amp; <a class="code" href="namespaceBarry.html#6e6ca3f4de1f16eed89c26548bee2e82">operator&lt;&lt;</a>(std::ostream &amp;os, <span class="keyword">const</span> <a class="code" href="structBarry_1_1Date.html">Date</a> &amp;date)
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647         os      &lt;&lt; setw(4) &lt;&lt; date.<a class="code" href="structBarry_1_1Date.html#4e897515f03cf0b810fc96c7d8716164">Year</a> &lt;&lt; <span class="charliteral">'/'</span>
<a name="l00648"></a>00648                 &lt;&lt; setw(2) &lt;&lt; date.<a class="code" href="structBarry_1_1Date.html#912e43788fedf766707ff89cba50dbd7">Month</a> &lt;&lt; <span class="charliteral">'/'</span>
<a name="l00649"></a>00649                 &lt;&lt; setw(2) &lt;&lt; date.<a class="code" href="structBarry_1_1Date.html#a928a25232ce4756ad3774fbf70981f9">Day</a>;
<a name="l00650"></a>00650         <span class="keywordflow">return</span> os;
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 } <span class="comment">// namespace Barry</span>
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 <span class="preprocessor">#ifdef __TEST_MODE__</span>
<a name="l00659"></a>00659 <span class="preprocessor"></span>
<a name="l00660"></a>00660 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 <span class="keywordtype">int</span> <a class="code" href="bcharge_8cc.html#0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00663"></a>00663 {
<a name="l00664"></a>00664         <span class="keywordflow">if</span>( argc &lt; 2 ) {
<a name="l00665"></a>00665                 cerr &lt;&lt; <span class="stringliteral">"Usage: test &lt;datafile&gt;"</span> &lt;&lt; endl;
<a name="l00666"></a>00666                 <span class="keywordflow">return</span> 1;
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         std::vector&lt;Data&gt; array;
<a name="l00670"></a>00670         <span class="keywordflow">if</span>( !<a class="code" href="namespaceBarry.html#5851c90040d10790103218a9b0b49768">LoadDataArray</a>(argv[1], array) ) {
<a name="l00671"></a>00671                 cerr &lt;&lt; <span class="stringliteral">"Unable to load file: "</span> &lt;&lt; argv[1] &lt;&lt; endl;
<a name="l00672"></a>00672                 <span class="keywordflow">return</span> 1;
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         cout &lt;&lt; <span class="stringliteral">"Loaded "</span> &lt;&lt; array.size() &lt;&lt; <span class="stringliteral">" items"</span> &lt;&lt; endl;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         <span class="keywordflow">for</span>( std::vector&lt;Data&gt;::iterator b = array.begin(), e = array.end();
<a name="l00678"></a>00678                 b != e; b++ )
<a name="l00679"></a>00679         {
<a name="l00680"></a>00680                 Data &amp;d = *b;
<a name="l00681"></a>00681 <span class="comment">//              cout &lt;&lt; d &lt;&lt; endl;</span>
<a name="l00682"></a>00682                 <span class="keywordflow">if</span>( d.GetSize() &gt; 13 &amp;&amp; d.GetData()[6] == 0x4f ) {
<a name="l00683"></a>00683                         <a class="code" href="classBarry_1_1Contact.html">Barry::Contact</a> contact;
<a name="l00684"></a>00684                         size_t size = 13;
<a name="l00685"></a>00685                         contact.ParseFields(d, size);
<a name="l00686"></a>00686                         cout &lt;&lt; contact &lt;&lt; endl;
<a name="l00687"></a>00687                         contact.DumpLdif(cout, <span class="stringliteral">"ou=People,dc=example,dc=com"</span>);
<a name="l00688"></a>00688                 }
<a name="l00689"></a>00689                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( d.GetSize() &gt; 13 &amp;&amp; d.GetData()[6] == 0x44 ) {
<a name="l00690"></a>00690                         <a class="code" href="classBarry_1_1Calendar.html">Barry::Calendar</a> cal;
<a name="l00691"></a>00691                         size_t size = 13;
<a name="l00692"></a>00692                         cal.ParseFields(d, size);
<a name="l00693"></a>00693                         cout &lt;&lt; cal &lt;&lt; endl;
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695         }
<a name="l00696"></a>00696 }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="preprocessor">#endif</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Sep 24 21:27:32 2008 for Barry by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
